<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiniOS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-image: url('/api/placeholder/1920/1080');
            background-size: cover;
            background-position: center;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        #desktop {
            flex-grow: 1;
            position: relative;
            padding: 20px;
        }
        
        #taskbar {
            height: 50px;
            background-color: rgba(25, 25, 25, 0.8);
            display: flex;
            align-items: center;
            padding: 0 15px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
        }
        
        #start-menu {
            background-color: #0078d7;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 18px;
            transition: background-color 0.3s;
        }
        
        #start-menu:hover {
            background-color: #0063b1;
        }
        
        #clock {
            margin-left: auto;
            color: white;
            font-size: 14px;
        }
        
        .icon {
            width: 80px;
            height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
        }
        
        .icon:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .icon-img {
            width: 40px;
            height: 40px;
            background-color: #0078d7;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }
        
        .icon-label {
            color: white;
            text-align: center;
            font-size: 12px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }
        
        .window {
            position: absolute;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-width: 300px;
            min-height: 200px;
            resize: both;
        }
        
        .window-header {
            height: 32px;
            background-color: #0078d7;
            display: flex;
            align-items: center;
            padding: 0 10px;
            cursor: move;
        }
        
        .window-title {
            color: white;
            flex-grow: 1;
            font-size: 14px;
        }
        
        .window-close {
            width: 24px;
            height: 24px;
            background-color: #e81123;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .window-content {
            flex-grow: 1;
            padding: 15px;
            overflow: auto;
        }
        
        #start-menu-panel {
            position: absolute;
            bottom: 50px;
            left: 0;
            width: 300px;
            background-color: rgba(25, 25, 25, 0.9);
            color: white;
            border-radius: 5px 5px 0 0;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
        }
        
        .menu-item {
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .menu-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            background-color: #0078d7;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #taskbar-apps {
            display: flex;
            margin-left: 10px;
        }
        
        .taskbar-app {
            height: 40px;
            width: 40px;
            margin-right: 5px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
        }
        
        .taskbar-app.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-bottom: 2px solid #0078d7;
        }
        
        .note-content {
            width: 100%;
            height: 100%;
            border: none;
            resize: none;
            outline: none;
            padding: 5px;
            font-size: 14px;
        }
        
        .calculator-display {
            background-color: #f0f0f0;
            padding: 15px;
            text-align: right;
            font-size: 24px;
            font-weight: bold;
            border-radius: 3px;
            margin-bottom: 10px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
        }
        
        .calc-btn {
            padding: 15px;
            border: none;
            border-radius: 3px;
            background-color: #e6e6e6;
            cursor: pointer;
            font-size: 16px;
        }
        
        .calc-btn:hover {
            background-color: #d1d1d1;
        }
        
        .calc-btn.operator {
            background-color: #f5923e;
            color: white;
        }
        
        .calc-btn.equals {
            background-color: #0078d7;
            color: white;
        }
        
        .browser-toolbar {
            display: flex;
            padding: 10px;
            background-color: #f5f5f5;
            border-bottom: 1px solid #ddd;
        }
        
        .browser-url {
            flex-grow: 1;
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 15px;
            margin: 0 10px;
        }
        
        .browser-content {
            padding: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .browser-page {
            flex-grow: 1;
            padding: 15px;
            overflow: auto;
        }
    </style>
</head>
<body>
    <div id="desktop">
        <!-- Desktop icons -->
        <div class="icon" data-app="notepad">
            <div class="icon-img">üìù</div>
            <div class="icon-label">Blocco note</div>
        </div>
        
        <div class="icon" data-app="calculator">
            <div class="icon-img">üßÆ</div>
            <div class="icon-label">Calcolatrice</div>
        </div>
        
        <div class="icon" data-app="browser">
            <div class="icon-img">üåê</div>
            <div class="icon-label">Browser</div>
        </div>
        
        <div id="start-menu-panel">
            <div class="menu-item" data-app="notepad">
                <div class="menu-icon">üìù</div>
                Blocco note
            </div>
            <div class="menu-item" data-app="calculator">
                <div class="menu-icon">üßÆ</div>
                Calcolatrice
            </div>
            <div class="menu-item" data-app="browser">
                <div class="menu-icon">üåê</div>
                Browser
            </div>
            <div class="menu-item" id="shutdown">
                <div class="menu-icon">‚èª</div>
                Spegni
            </div>
        </div>
    </div>
    
    <div id="taskbar">
        <button id="start-menu">‚â°</button>
        <div id="taskbar-apps"></div>
        <div id="clock"></div>
    </div>

    <script>
        let windows = [];
        let activeWindow = null;
        let zIndex = 10;
        
        // Update clock
        function updateClock() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            document.getElementById('clock').textContent = `${hours}:${minutes}`;
        }
        
        updateClock();
        setInterval(updateClock, 60000);
        
        // Start menu toggle
        document.getElementById('start-menu').addEventListener('click', function() {
            const menu = document.getElementById('start-menu-panel');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        });
        
        // Close start menu when clicking elsewhere
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#start-menu') && !e.target.closest('#start-menu-panel')) {
                document.getElementById('start-menu-panel').style.display = 'none';
            }
        });
        
        // Create window
        function createWindow(app, title, content, width = 600, height = 400) {
            const id = 'window-' + Date.now();
            
            // Create window element
            const windowEl = document.createElement('div');
            windowEl.className = 'window';
            windowEl.id = id;
            windowEl.style.width = width + 'px';
            windowEl.style.height = height + 'px';
            windowEl.style.left = Math.round((window.innerWidth - width) / 2) + 'px';
            windowEl.style.top = Math.round((window.innerHeight - height) / 3) + 'px';
            windowEl.dataset.app = app;
            
            // Create window header
            const header = document.createElement('div');
            header.className = 'window-header';
            
            const titleEl = document.createElement('div');
            titleEl.className = 'window-title';
            titleEl.textContent = title;
            header.appendChild(titleEl);
            
            const closeBtn = document.createElement('button');
            closeBtn.className = 'window-close';
            closeBtn.textContent = '‚úï';
            closeBtn.addEventListener('click', function() {
                closeWindow(id);
            });
            header.appendChild(closeBtn);
            
            // Add header to window
            windowEl.appendChild(header);
            
            // Add content
            const contentEl = document.createElement('div');
            contentEl.className = 'window-content';
            contentEl.innerHTML = content;
            windowEl.appendChild(contentEl);
            
            // Add window to desktop
            document.getElementById('desktop').appendChild(windowEl);
            
            // Add to taskbar
            const taskbarApp = document.createElement('div');
            taskbarApp.className = 'taskbar-app';
            taskbarApp.dataset.window = id;
            taskbarApp.textContent = app === 'notepad' ? 'üìù' : app === 'calculator' ? 'üßÆ' : 'üåê';
            taskbarApp.addEventListener('click', function() {
                if (windowEl.style.display === 'none') {
                    windowEl.style.display = 'flex';
                    updateTaskbar();
                }
                activateWindow(id);
            });
            document.getElementById('taskbar-apps').appendChild(taskbarApp);
            
            // Store window data
            const windowData = {
                id,
                app,
                element: windowEl,
                taskbarApp
            };
            windows.push(windowData);
            
            // Make window draggable
            makeDraggable(windowEl, header);
            
            // Activate the window
            activateWindow(id);
            
            return windowData;
        }
        
        // Close window
        function closeWindow(id) {
            const index = windows.findIndex(w => w.id === id);
            if (index > -1) {
                // Remove window element
                windows[index].element.remove();
                
                // Remove taskbar entry
                windows[index].taskbarApp.remove();
                
                // Remove from windows array
                windows.splice(index, 1);
                
                // Update active window
                if (activeWindow && activeWindow.id === id) {
                    activeWindow = windows.length > 0 ? windows[windows.length - 1] : null;
                    if (activeWindow) {
                        activateWindow(activeWindow.id);
                    }
                }
            }
        }
        
        // Activate window
        function activateWindow(id) {
            // Deactivate all windows
            windows.forEach(w => {
                w.element.style.zIndex = 10;
                w.taskbarApp.classList.remove('active');
            });
            
            // Activate the selected window
            const window = windows.find(w => w.id === id);
            if (window) {
                window.element.style.zIndex = zIndex++;
                window.taskbarApp.classList.add('active');
                activeWindow = window;
            }
        }
        
        // Update taskbar
        function updateTaskbar() {
            windows.forEach(w => {
                w.taskbarApp.classList.toggle('active', w.element.style.display !== 'none');
            });
        }
        
        function makeDraggable(element, handle) {
    let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    
    handle.onmousedown = dragMouseDown;
    
    function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();
        // Get the mouse cursor position at startup
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        // Call a function whenever the cursor moves
        document.onmousemove = elementDrag;
        
        // Activate the window
        activateWindow(element.id);
    }
    
    function elementDrag(e) {
        e = e || window.event;
        e.preventDefault();
        // Calculate the new cursor position
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        // Set the element's new position
        element.style.top = (element.offsetTop - pos2) + "px";
        element.style.left = (element.offsetLeft - pos1) + "px";
    }
    
    function closeDragElement() {
        // Stop moving when mouse button is released
        document.onmouseup = null;
        document.onmousemove = null;
    }
}

// Open application
function openApp(app) {
    // Close the start menu
    document.getElementById('start-menu-panel').style.display = 'none';
    
    // Check if the app is already open
    const existingWindow = windows.find(w => w.app === app);
    if (existingWindow) {
        activateWindow(existingWindow.id);
        return;
    }
    
    // Create appropriate window based on app type
    switch(app) {
        case 'notepad':
            createWindow(
                'notepad',
                'Blocco note',
                '<textarea class="note-content" placeholder="Scrivi qui..."></textarea>',
                600,
                400
            );
            break;
        case 'calculator':
            const calcContent = `
                <div class="calculator-display">0</div>
                <div class="calculator-buttons">
                    <button class="calc-btn">C</button>
                    <button class="calc-btn">¬±</button>
                    <button class="calc-btn">%</button>
                    <button class="calc-btn operator">√∑</button>
                    <button class="calc-btn">7</button>
                    <button class="calc-btn">8</button>
                    <button class="calc-btn">9</button>
                    <button class="calc-btn operator">√ó</button>
                    <button class="calc-btn">4</button>
                    <button class="calc-btn">5</button>
                    <button class="calc-btn">6</button>
                    <button class="calc-btn operator">-</button>
                    <button class="calc-btn">1</button>
                    <button class="calc-btn">2</button>
                    <button class="calc-btn">3</button>
                    <button class="calc-btn operator">+</button>
                    <button class="calc-btn">0</button>
                    <button class="calc-btn">.</button>
                    <button class="calc-btn">DEL</button>
                    <button class="calc-btn equals">=</button>
                </div>
            `;
            const calcWindow = createWindow('calculator', 'Calcolatrice', calcContent, 300, 400);
            
            // Add calculator functionality
            const display = calcWindow.element.querySelector('.calculator-display');
            const buttons = calcWindow.element.querySelectorAll('.calc-btn');
            
            let currentInput = '0';
            let previousInput = '';
            let operation = null;
            let resetInput = false;
            
            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    const value = button.textContent;
                    
                    if (!isNaN(value) || value === '.') {
                        // Handle number input
                        if (resetInput) {
                            currentInput = value === '.' ? '0.' : value;
                            resetInput = false;
                        } else {
                            if (currentInput === '0' && value !== '.') {
                                currentInput = value;
                            } else {
                                if (value === '.' && currentInput.includes('.')) return;
                                currentInput += value;
                            }
                        }
                        display.textContent = currentInput;
                    } else if (value === 'C') {
                        // Clear
                        currentInput = '0';
                        previousInput = '';
                        operation = null;
                        display.textContent = currentInput;
                    } else if (value === '¬±') {
                        // Toggle sign
                        currentInput = (parseFloat(currentInput) * -1).toString();
                        display.textContent = currentInput;
                    } else if (value === '%') {
                        // Percentage
                        currentInput = (parseFloat(currentInput) / 100).toString();
                        display.textContent = currentInput;
                    } else if (value === 'DEL') {
                        // Delete last character
                        currentInput = currentInput.slice(0, -1);
                        if (currentInput === '' || currentInput === '-') currentInput = '0';
                        display.textContent = currentInput;
                    } else if (value === '=') {
                        // Calculate result
                        if (operation && previousInput !== '') {
                            const prev = parseFloat(previousInput);
                            const current = parseFloat(currentInput);
                            let result;
                            
                            switch(operation) {
                                case '+': result = prev + current; break;
                                case '-': result = prev - current; break;
                                case '√ó': result = prev * current; break;
                                case '√∑': result = prev / current; break;
                            }
                            
                            currentInput = result.toString();
                            previousInput = '';
                            operation = null;
                            display.textContent = currentInput;
                            resetInput = true;
                        }
                    } else {
                        // Operation
                        if (previousInput === '') {
                            previousInput = currentInput;
                        } else if (operation) {
                            // Chain operations
                            const prev = parseFloat(previousInput);
                            const current = parseFloat(currentInput);
                            let result;
                            
                            switch(operation) {
                                case '+': result = prev + current; break;
                                case '-': result = prev - current; break;
                                case '√ó': result = prev * current; break;
                                case '√∑': result = prev / current; break;
                            }
                            
                            previousInput = result.toString();
                        }
                        
                        operation = value;
                        resetInput = true;
                        display.textContent = previousInput;
                    }
                });
            });
            break;
        case 'browser':
            const browserContent = `
                <div class="browser-content">
                    <div class="browser-toolbar">
                        <button class="browser-back">‚Üê</button>
                        <button class="browser-forward">‚Üí</button>
                        <button class="browser-refresh">‚Üª</button>
                        <input type="text" class="browser-url" value="https://mini-os.example.com">
                        <button class="browser-go">Go</button>
                    </div>
                    <div class="browser-page">
                        <h1>Benvenuto nel Mini Browser</h1>
                        <p>Questo √® un browser web simulato all'interno del nostro Mini OS.</p>
                        <p>Puoi navigare tra le pagine usando i pulsanti o digitando un URL.</p>
                        <hr>
                        <h2>Pagine disponibili:</h2>
                        <ul>
                            <li><a href="#home">Home</a></li>
                            <li><a href="#about">About</a></li>
                            <li><a href="#contact">Contatti</a></li>
                        </ul>
                    </div>
                </div>
            `;
            const browserWindow = createWindow('browser', 'Browser', browserContent, 700, 500);
            
            // Add browser functionality
            const pages = {
                'home': `
                    <h1>Benvenuto nel Mini Browser</h1>
                    <p>Questo √® un browser web simulato all'interno del nostro Mini OS.</p>
                    <p>Puoi navigare tra le pagine usando i pulsanti o digitando un URL.</p>
                    <hr>
                    <h2>Pagine disponibili:</h2>
                    <ul>
                        <li><a href="#home">Home</a></li>
                        <li><a href="#about">About</a></li>
                        <li><a href="#contact">Contatti</a></li>
                    </ul>
                `,
                'about': `
                    <h1>About Mini OS</h1>
                    <p>Mini OS √® un sistema operativo simulato creato con HTML, CSS e JavaScript.</p>
                    <p>Caratteristiche principali:</p>
                    <ul>
                        <li>Desktop con icone</li>
                        <li>Finestre ridimensionabili e trascinabili</li>
                        <li>Applicazioni funzionanti</li>
                        <li>Barra delle applicazioni con menu Start</li>
                    </ul>
                    <p><a href="#home">Torna alla Home</a></p>
                `,
                'contact': `
                    <h1>Contatti</h1>
                    <p>Questo √® un progetto dimostrativo per GitHub.</p>
                    <p>Puoi contattarci attraverso la nostra pagina GitHub.</p>
                    <p><a href="#home">Torna alla Home</a></p>
                `
            };
            
            const browserPage = browserWindow.element.querySelector('.browser-page');
            const urlInput = browserWindow.element.querySelector('.browser-url');
            const goButton = browserWindow.element.querySelector('.browser-go');
            const backButton = browserWindow.element.querySelector('.browser-back');
            const forwardButton = browserWindow.element.querySelector('.browser-forward');
            const refreshButton = browserWindow.element.querySelector('.browser-refresh');
            
            let currentPage = 'home';
            let history = ['home'];
            let historyIndex = 0;
            
            function loadPage(page) {
                if (pages[page]) {
                    browserPage.innerHTML = pages[page];
                    currentPage = page;
                    urlInput.value = `https://mini-os.example.com/${page}`;
                    
                    // Handle links
                    browserPage.querySelectorAll('a').forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            const href = link.getAttribute('href').substring(1);
                            if (pages[href]) {
                                history = history.slice(0, historyIndex + 1);
                                history.push(href);
                                historyIndex = history.length - 1;
                                loadPage(href);
                            }
                        });
                    });
                } else {
                    browserPage.innerHTML = `
                        <h1>Pagina non trovata</h1>
                        <p>La pagina "${page}" non esiste.</p>
                        <p><a href="#home">Torna alla Home</a></p>
                    `;
                }
            }
            
            goButton.addEventListener('click', () => {
                const url = urlInput.value;
                const match = url.match(/mini-os\.example\.com\/([a-z]*)/);
                if (match) {
                    const page = match[1] || 'home';
                    history = history.slice(0, historyIndex + 1);
                    history.push(page);
                    historyIndex = history.length - 1;
                    loadPage(page);
                }
            });
            
            backButton.addEventListener('click', () => {
                if (historyIndex > 0) {
                    historyIndex--;
                    loadPage(history[historyIndex]);
                }
            });
            
            forwardButton.addEventListener('click', () => {
                if (historyIndex < history.length - 1) {
                    historyIndex++;
                    loadPage(history[historyIndex]);
                }
            });
            
            refreshButton.addEventListener('click', () => {
                loadPage(currentPage);
            });
            
            // Links event delegation
            browserPage.addEventListener('click', (e) => {
                if (e.target.tagName === 'A') {
                    e.preventDefault();
                    const href = e.target.getAttribute('href').substring(1);
                    if (pages[href]) {
                        history = history.slice(0, historyIndex + 1);
                        history.push(href);
                        historyIndex = history.length - 1;
                        loadPage(href);
                    }
                }
            });
            
            // Initialize with home page
            loadPage('home');
            break;
    }
}

// Handle desktop icon clicks
document.querySelectorAll('.icon').forEach(icon => {
    icon.addEventListener('click', function() {
        const app = this.dataset.app;
        openApp(app);
    });
});

// Handle start menu item clicks
document.querySelectorAll('.menu-item').forEach(item => {
    item.addEventListener('click', function() {
        const app = this.dataset.app;
        if (app) {
            openApp(app);
        } else if (this.id === 'shutdown') {
            if (confirm('Sei sicuro di voler spegnere il Mini OS?')) {
                document.body.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #000; color: #fff; font-size: 24px;">Sistema spento. Aggiorna la pagina per riavviare.</div>';
            }
        }
    });
});

// Initialize the system
window.addEventListener('load', function() {
    // Welcome message
    setTimeout(() => {
        alert('Benvenuto nel Mini OS!\n\nQuesto √® un sistema operativo simulato creato con HTML, CSS e JavaScript.\n\nPuoi aprire le applicazioni facendo clic sulle icone sul desktop o dal menu Start.');
    }, 500);
});
</script>
</body>
</html>
