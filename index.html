<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        canvas {
            border: 2px solid #333;
            background-color: #222;
        }
        .game-info {
            margin-top: 20px;
            text-align: center;
        }
        button {
            padding: 8px 16px;
            margin-top: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <h1>Snake Game</h1>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <div class="game-info">
        <p>Punteggio: <span id="score">0</span></p>
        <p>Record: <span id="highScore">0</span></p>
        <button id="startButton">Inizia Gioco</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreElement = document.getElementById('score');
            const highScoreElement = document.getElementById('highScore');
            const startButton = document.getElementById('startButton');

            // Dimensioni della griglia
            const gridSize = 20;
            const tileCount = canvas.width / gridSize;
            
            // Inizializzazione del serpente
            let snake = [];
            let velocityX = 0;
            let velocityY = 0;
            let food = {};
            let score = 0;
            let highScore = localStorage.getItem('snakeHighScore') || 0;
            let gameOver = true;
            let gameLoop;

            highScoreElement.textContent = highScore;

            // Inizializza il gioco
            function init() {
                snake = [{x: 10, y: 10}];
                velocityX = 0;
                velocityY = 0;
                score = 0;
                scoreElement.textContent = score;
                placeFood();
                gameOver = false;
            }

            // Posiziona il cibo in una posizione casuale
            function placeFood() {
                food = {
                    x: Math.floor(Math.random() * tileCount),
                    y: Math.floor(Math.random() * tileCount)
                };
                
                // Verifica che il cibo non sia posizionato sul serpente
                for (let i = 0; i < snake.length; i++) {
                    if (snake[i].x === food.x && snake[i].y === food.y) {
                        placeFood();
                        break;
                    }
                }
            }

            // Aggiorna il gioco
            function update() {
                if (gameOver) return;

                // Muovi il serpente
                const head = {
                    x: snake[0].x + velocityX,
                    y: snake[0].y + velocityY
                };

                // Controlla collisione con bordi
                if (head.x < 0 || head.y < 0 || head.x >= tileCount || head.y >= tileCount) {
                    endGame();
                    return;
                }

                // Controlla collisione con se stesso
                for (let i = 0; i < snake.length; i++) {
                    if (snake[i].x === head.x && snake[i].y === head.y) {
                        endGame();
                        return;
                    }
                }

                snake.unshift(head);

                // Controlla se ha mangiato il cibo
                if (head.x === food.x && head.y === food.y) {
                    score++;
                    scoreElement.textContent = score;
                    if (score > highScore) {
                        highScore = score;
                        highScoreElement.textContent = highScore;
                        localStorage.setItem('snakeHighScore', highScore);
                    }
                    placeFood();
                } else {
                    snake.pop();
                }
            }

            // Disegna il gioco
            function draw() {
                // Pulisci il canvas
                ctx.fillStyle = '#222';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Disegna il serpente
                ctx.fillStyle = '#4CAF50';
                for (let i = 0; i < snake.length; i++) {
                    ctx.fillRect(
                        snake[i].x * gridSize, 
                        snake[i].y * gridSize, 
                        gridSize - 1, 
                        gridSize - 1
                    );
                }

                // Disegna la testa in un colore diverso
                if (snake.length > 0) {
                    ctx.fillStyle = '#2E7D32';
                    ctx.fillRect(
                        snake[0].x * gridSize, 
                        snake[0].y * gridSize, 
                        gridSize - 1, 
                        gridSize - 1
                    );
                }

                // Disegna il cibo
                ctx.fillStyle = '#FF5722';
                ctx.fillRect(
                    food.x * gridSize, 
                    food.y * gridSize, 
                    gridSize - 1, 
                    gridSize - 1
                );

                // Disegna messaggio di game over
                if (gameOver && snake.length > 0) {
                    ctx.fillStyle = 'white';
                    ctx.font = '30px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('Game Over', canvas.width / 2, canvas.height / 2);
                    ctx.font = '20px Arial';
                    ctx.fillText('Premi "Inizia Gioco" per ricominciare', canvas.width / 2, canvas.height / 2 + 30);
                }
            }

            // Loop principale del gioco
            function gameStep() {
                update();
                draw();
            }

            // Termina il gioco
            function endGame() {
                gameOver = true;
                clearInterval(gameLoop);
            }

            // Eventi di input da tastiera
            document.addEventListener('keydown', function(e) {
                if (gameOver) return;
                
                switch(e.key) {
                    case 'ArrowUp':
                        if (velocityY !== 1) {
                            velocityX = 0;
                            velocityY = -1;
                        }
                        break;
                    case 'ArrowDown':
                        if (velocityY !== -1) {
                            velocityX = 0;
                            velocityY = 1;
                        }
                        break;
                    case 'ArrowLeft':
                        if (velocityX !== 1) {
                            velocityX = -1;
                            velocityY = 0;
                        }
                        break;
                    case 'ArrowRight':
                        if (velocityX !== -1) {
                            velocityX = 1;
                            velocityY = 0;
                        }
                        break;
                }
            });

            // Pulsante di inizio
            startButton.addEventListener('click', function() {
                if (gameOver) {
                    init();
                    clearInterval(gameLoop);
                    gameLoop = setInterval(gameStep, 100);
                }
            });

            // Disegna lo schermo iniziale
            draw();
        });
    </script>
</body>
</html>
